metadata:
  name: validate-data
  labels:
    nuclio.io/project-name: validation-scenario
spec:
  disable: true
  handler: "main:handler"
  runtime: "python:3.8"
  env:
    - name: METADATA_STORE_URI
      value: "http://metadata_store_address"
    - name: METADATA_STORE_CONFIG_AUTH
      value: oauth
    - name: METADATA_STORE_CONFIG_OAUTH_TOKEN
      value: insert_token_value_here
    - name: DATA_STORE_CONFIG_ENDPOINT_URL
      value: "https://data_store_address"
    - name: DATA_STORE_CONFIG_AWS_ACCESS_KEY_ID
      value: insert_access_key_here
    - name: DATA_STORE_CONFIG_AWS_SECRET_ACCESS_KEY
      value: insert_access_secret_here
    - name: DATA_STORE_CONFIG_REGION_NAME
      value: us-east-1
    - name: PROJECT_ID
      value: insert_project_id_here
    - name: DATA_STORE_URI
      value: "s3://bucket_name"
    - name: METADATA_STORE_CONFIG_BASIC_USER
      value: insert_user_here
    - name: METADATA_STORE_CONFIG_BASIC_PASSWORD
      value: insert_password_here
  resources: {}
  triggers:
    default-http:
      class: ""
      kind: http
      name: default-http
      maxWorkers: 1
  version: 1
  build:
    functionSourceCode: aW1wb3J0IG9zDQppbXBvcnQgZGF0YWp1ZGdlIGFzIGRqDQoNCmRlZiBnZXRfZGF0YV9zdG9yZV9jb25maWcoKToNCiAgICBkYXRhX3N0b3JlX2NvbmZpZ19wcmVmaXggPSAnREFUQV9TVE9SRV9DT05GSUdfJw0KICAgIGRhdGFfc3RvcmVfY29uZmlnID0ge30NCiAgICANCiAgICBmb3Iga2V5IGluIG9zLmVudmlyb246DQogICAgICAgIGlmIGtleS5zdGFydHN3aXRoKGRhdGFfc3RvcmVfY29uZmlnX3ByZWZpeCk6DQogICAgICAgICAgICBjb25maWdfa2V5ID0ga2V5LnNwbGl0KGRhdGFfc3RvcmVfY29uZmlnX3ByZWZpeCwxKVsxXS5sb3dlcigpDQogICAgICAgICAgICBjb25maWdfdmFsdWUgPSBvcy5lbnZpcm9uLmdldChrZXkpDQogICAgICAgICAgICBkYXRhX3N0b3JlX2NvbmZpZ1tjb25maWdfa2V5XSA9IGNvbmZpZ192YWx1ZQ0KICAgICAgICAgICAgDQogICAgcmV0dXJuIGRhdGFfc3RvcmVfY29uZmlnDQogICAgDQpkZWYgZ2V0X21ldGFkYXRhX3N0b3JlX2NvbmZpZygpOg0KICAgIGF1dGggPSBvcy5lbnZpcm9uLmdldCgnTUVUQURBVEFfU1RPUkVfQ09ORklHX0FVVEgnKQ0KICAgIA0KICAgIGNvbmZpZyA9IHsNCiAgICAgICAgJ2F1dGgnOiBhdXRoDQogICAgfQ0KICAgIA0KICAgIGlmIGF1dGggPT0gJ29hdXRoJzoNCiAgICAgICAgY29uZmlnWyd0b2tlbiddID0gb3MuZW52aXJvbi5nZXQoJ01FVEFEQVRBX1NUT1JFX0NPTkZJR19PQVVUSF9UT0tFTicpDQogICAgZWxpZiBhdXRoID09ICdiYXNpYyc6DQogICAgICAgIGNvbmZpZ1sndXNlciddID0gb3MuZW52aXJvbi5nZXQoJ01FVEFEQVRBX1NUT1JFX0NPTkZJR19CQVNJQ19VU0VSJykNCiAgICAgICAgY29uZmlnWydwYXNzd29yZCddID0gb3MuZW52aXJvbi5nZXQoJ01FVEFEQVRBX1NUT1JFX0NPTkZJR19CQVNJQ19QQVNTV09SRCcpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIG51bGwNCiAgICANCiAgICByZXR1cm4gY29uZmlnDQogICAgDQpkZWYgaGFuZGxlX3RleHRfYm9keShyZXF1ZXN0X2JvZHksIHByb2plY3RfaWQsIGRhdGFfc3RvcmVfdXJpLCBkYXRhX3N0b3JlX2NvbmZpZyk6DQogICAgdHJ5Og0KICAgICAgICBpbnB1dF9yZXNvdXJjZV9wYXRoX3VyaSA9IHJlcXVlc3RfYm9keS5kZWNvZGUoJ3V0Zi04JykNCiAgICAgICAgDQogICAgICAgIGNsaWVudCA9IGRqLkNsaWVudCgNCiAgICAgICAgICAgICAgICBwcm9qZWN0X2lkID0gcHJvamVjdF9pZCwNCiAgICAgICAgICAgICAgICBkYXRhX3N0b3JlX3VyaSA9IGRhdGFfc3RvcmVfdXJpLA0KICAgICAgICAgICAgICAgIGRhdGFfc3RvcmVfY29uZmlnID0gZGF0YV9zdG9yZV9jb25maWcNCiAgICAgICAgKQ0KICAgICAgICANCiAgICAgICAgZGF0YV9yZXNvdXJjZSA9IGRqLkRhdGFSZXNvdXJjZShpbnB1dF9yZXNvdXJjZV9wYXRoX3VyaSkNCiAgICAgICAgDQogICAgICAgIHJ1biA9IGNsaWVudC5jcmVhdGVfcnVuKGRhdGFfcmVzb3VyY2UsICJmcmljdGlvbmxlc3MiKQ0KICAgICAgICANCiAgICAgICAgd2l0aCBydW46DQogICAgICAgICAgICByZXBvcnQgPSBydW4udmFsaWRhdGVfcmVzb3VyY2UoKQ0KICAgICAgICAgICAgDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICByZXR1cm4geydlcnJvcic6ICdBbiBlcnJvciBoYXMgb2NjdXJyZWQgd2hpbGUgdmFsaWRhdGluZyBkYXRhOiB7fScuZm9ybWF0KGUpfQ0KICAgICAgICANCiAgICByZXR1cm4gcmVwb3J0DQogICAgDQpkZWYgaGFuZGxlX2pzb25fYm9keShyZXF1ZXN0X2JvZHksIHByb2plY3RfaWQsIGRhdGFfc3RvcmVfdXJpLCBkYXRhX3N0b3JlX2NvbmZpZyk6DQogICAgaW5wdXRfZGF0YV9zdG9yZV91cmkgPSByZXF1ZXN0X2JvZHkuZ2V0KCdkYXRhU3RvcmVVcmknKQ0KICAgIGlmIGlucHV0X2RhdGFfc3RvcmVfdXJpOg0KICAgICAgICBkYXRhX3N0b3JlX3VyaSA9IGlucHV0X2RhdGFfc3RvcmVfdXJpDQogICAgDQogICAgbWV0YWRhdGFfc3RvcmVfdXJpID0gb3MuZW52aXJvbi5nZXQoJ01FVEFEQVRBX1NUT1JFX1VSSScpDQogICAgbWV0YWRhdGFfc3RvcmVfY29uZmlnID0gZ2V0X21ldGFkYXRhX3N0b3JlX2NvbmZpZygpDQogICAgDQogICAgZXhwZXJpbWVudF9pZCA9IHJlcXVlc3RfYm9keS5nZXQoJ2V4cGVyaW1lbnRJZCcpDQogICAgDQogICAgbWV0YWRhdGFfc3RvcmVfaXNfY29uZmlndXJlZCA9IGV4cGVyaW1lbnRfaWQgYW5kIHByb2plY3RfaWQgYW5kIG1ldGFkYXRhX3N0b3JlX3VyaSBhbmQgbWV0YWRhdGFfc3RvcmVfY29uZmlnDQogICAgDQogICAgdHJ5Og0KICAgICAgICBpZiBtZXRhZGF0YV9zdG9yZV9pc19jb25maWd1cmVkOg0KICAgICAgICAgICAgY2xpZW50ID0gZGouQ2xpZW50KA0KICAgICAgICAgICAgICAgICAgICBwcm9qZWN0X2lkID0gcHJvamVjdF9pZCwNCiAgICAgICAgICAgICAgICAgICAgZXhwZXJpbWVudF9uYW1lID0gZXhwZXJpbWVudF9pZCwNCiAgICAgICAgICAgICAgICAgICAgZGF0YV9zdG9yZV91cmkgPSBkYXRhX3N0b3JlX3VyaSwNCiAgICAgICAgICAgICAgICAgICAgZGF0YV9zdG9yZV9jb25maWcgPSBkYXRhX3N0b3JlX2NvbmZpZywNCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFfc3RvcmVfdXJpID0gbWV0YWRhdGFfc3RvcmVfdXJpLA0KICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YV9zdG9yZV9jb25maWcgPSBtZXRhZGF0YV9zdG9yZV9jb25maWcNCiAgICAgICAgICAgICkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGNsaWVudCA9IGRqLkNsaWVudCgNCiAgICAgICAgICAgICAgICAgICAgcHJvamVjdF9pZCA9IHByb2plY3RfaWQsDQogICAgICAgICAgICAgICAgICAgIGRhdGFfc3RvcmVfdXJpID0gZGF0YV9zdG9yZV91cmksDQogICAgICAgICAgICAgICAgICAgIGRhdGFfc3RvcmVfY29uZmlnID0gZGF0YV9zdG9yZV9jb25maWcNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIA0KICAgICAgICByZXNvdXJjZV9wYXRoX3VyaSA9IHJlcXVlc3RfYm9keS5nZXQoJ3Jlc291cmNlUGF0aFVyaScpDQogICAgICAgIGlmIG5vdCByZXNvdXJjZV9wYXRoX3VyaToNCiAgICAgICAgICAgIHJldHVybiB7J2Vycm9yJzogJ1BsZWFzZSBwcm92aWRlIHJlc291cmNlUGF0aFVyaSd9DQogICAgICAgICAgICANCiAgICAgICAgcmVzb3VyY2Vfc2NoZW1hX3VyaSA9IHJlcXVlc3RfYm9keS5nZXQoJ3Jlc291cmNlU2NoZW1hVXJpJykNCiAgICAgICAgaWYgbm90IHJlc291cmNlX3NjaGVtYV91cmk6DQogICAgICAgICAgICByZXR1cm4geydlcnJvcic6ICdQbGVhc2UgcHJvdmlkZSByZXNvdXJjZVNjaGVtYVVyaSd9DQogICAgICAgICAgICANCiAgICAgICAgcmVzb3VyY2VfbmFtZSA9IHJlcXVlc3RfYm9keS5nZXQoJ3Jlc291cmNlTmFtZScpDQoNCiAgICAgICAgZGF0YV9yZXNvdXJjZSA9IGRqLkRhdGFSZXNvdXJjZSgNCiAgICAgICAgICAgICAgICByZXNvdXJjZV9wYXRoX3VyaSwNCiAgICAgICAgICAgICAgICBzY2hlbWE9cmVzb3VyY2Vfc2NoZW1hX3VyaSwNCiAgICAgICAgICAgICAgICBuYW1lPXJlc291cmNlX25hbWUNCiAgICAgICAgKQ0KICAgICAgICBydW4gPSBjbGllbnQuY3JlYXRlX3J1bihkYXRhX3Jlc291cmNlLCAiZnJpY3Rpb25sZXNzIikNCg0KICAgICAgICB3aXRoIHJ1bjoNCiAgICAgICAgICAgIHJlcG9ydCA9IHJ1bi52YWxpZGF0ZV9yZXNvdXJjZSgpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIG1ldGFkYXRhX3N0b3JlX2lzX2NvbmZpZ3VyZWQ6DQogICAgICAgICAgICAgICAgcnVuLmxvZ19kYXRhX3Jlc291cmNlKCkNCiAgICAgICAgICAgICAgICBydW4ubG9nX3Nob3J0X3NjaGVtYSgpDQogICAgICAgICAgICAgICAgcnVuLmxvZ19wcm9maWxlKCkNCiAgICAgICAgICAgICAgICBydW4ubG9nX3Nob3J0X3JlcG9ydChyZXBvcnQpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICByZXR1cm4geydlcnJvcic6ICdBbiBlcnJvciBoYXMgb2NjdXJyZWQgd2hpbGUgdmFsaWRhdGluZyBkYXRhOiB7fScuZm9ybWF0KGUpfQ0KICAgIHJldHVybiByZXBvcnQNCg0KZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOg0KICAgIGNvbnRlbnRfdHlwZSA9IGV2ZW50LmNvbnRlbnRfdHlwZS5kZWNvZGUoJ3V0Zi04JykNCiAgICByZXF1ZXN0X2JvZHkgPSBldmVudC5ib2R5DQogICAgDQogICAgY29udGVudF90eXBlX2pzb24gPSAnYXBwbGljYXRpb24vanNvbicNCiAgICBjb250ZW50X3R5cGVfdGV4dCA9ICd0ZXh0L3BsYWluJw0KICAgIA0KICAgIHByb2plY3RfaWQgPSBvcy5lbnZpcm9uLmdldCgnUFJPSkVDVF9JRCcpDQogICAgDQogICAgZGF0YV9zdG9yZV91cmkgPSBvcy5lbnZpcm9uLmdldCgnREFUQV9TVE9SRV9VUkknKQ0KICAgIGRhdGFfc3RvcmVfY29uZmlnID0gZ2V0X2RhdGFfc3RvcmVfY29uZmlnKCkNCiAgICANCiAgICBpZiBjb250ZW50X3R5cGUgPT0gY29udGVudF90eXBlX3RleHQ6DQogICAgICAgIHJldHVybiBoYW5kbGVfdGV4dF9ib2R5KHJlcXVlc3RfYm9keSwgcHJvamVjdF9pZCwgZGF0YV9zdG9yZV91cmksIGRhdGFfc3RvcmVfY29uZmlnKQ0KICAgICAgICANCiAgICBlbGlmIGNvbnRlbnRfdHlwZSA9PSBjb250ZW50X3R5cGVfanNvbjoNCiAgICAgICAgcmV0dXJuIGhhbmRsZV9qc29uX2JvZHkocmVxdWVzdF9ib2R5LCBwcm9qZWN0X2lkLCBkYXRhX3N0b3JlX3VyaSwgZGF0YV9zdG9yZV9jb25maWcpDQogICAgDQogICAgcmV0dXJuICgiSW52YWxpZCBjb250ZW50IHR5cGUgJ3swfScuIEFjY2VwdGVkIGNvbnRlbnQgdHlwZXM6IHsxfSIuZm9ybWF0KGNvbnRlbnRfdHlwZSwgW2NvbnRlbnRfdHlwZV9qc29uLCBjb250ZW50X3R5cGVfdGV4dF0pKQ==
    commands:
      - '/usr/local/bin/python -m pip install --upgrade pip'
      - 'pip3 install psutil'
      - 'wget https://github.com/alb-car/scenario/raw/main/library.zip'
      - 'unzip library.zip'
      - 'cd library && pip3 install .[all]'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1636719277
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  eventTimeout: ""
